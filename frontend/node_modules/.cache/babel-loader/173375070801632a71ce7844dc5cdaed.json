{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jenni\\\\Documents\\\\GitHub\\\\harjoitus4-JenniMERN\\\\frontend\\\\src\\\\components\\\\Login.js\",\n    _s2 = $RefreshSig$();\n\nimport React, { useContext, useState } from 'react';\nimport { Button, Form, Alert, Modal } from 'react-bootstrap';\nimport UserContext from '../contexts/UserContext';\nimport ErrorContext from '../contexts/ErrorContext';\nimport { login, logout } from '../user/services/user-services';\nimport Register from './Register';\nimport { BrowserRouter as Redirect, useHistory } from 'react-router-dom'; //Applikaation sivujen reititys\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Login = () => {\n  _s2();\n\n  var _s = $RefreshSig$();\n\n  const userContext = useContext(UserContext);\n  const errorContext = useContext(ErrorContext);\n  const [modalShow, setModalShow] = useState(false);\n  const [show, setShow] = useState(true); //Virheilmoituksen näyttämiseen\n\n  let history = useHistory();\n  let registerationSuccess = \"\"; //Alustetaan muuttuja, jotta ilmoitus rekisteröitymisen onnistumisesta pystytään näyttämään\n\n  const logOut = () => {\n    logout(userContext.logout, userContext.setEmail, userContext.setUsertype, userContext.setFirstname); //Kirjaudutaan ulos userContextissa olevan metodin avulla\n\n    console.log(userContext);\n    history.push('/'); //Palataan etusivulle\n  }; //Määritetään loginButtonin ulkoasu ja toiminnot sen perusteella, onko käyttäjä kirjautunut vai ei\n\n\n  let loginButton;\n\n  if (userContext.isLoggedIn === true) {\n    loginButton = /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"danger\",\n      onClick: logOut,\n      children: \"Kirjaudu ulos\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 20\n    }, this);\n  } else {\n    loginButton = /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"primary\",\n      onClick: () => setModalShow(true),\n      children: \"Kirjaudu\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 20\n    }, this);\n  }\n\n  console.log(userContext);\n\n  function MyVerticallyCenteredModal(props) {\n    _s();\n\n    const [user, setUser] = useState({\n      password: \"\",\n      name: \"\",\n      email: \"\"\n    });\n    const [visible, setVisible] = useState(false); //Rekisteröitymis-painiketta varten\n\n    const emptyErrorContext = e => {\n      errorContext.setAppError(null);\n      setVisible(!visible);\n    };\n\n    const button = /*#__PURE__*/_jsxDEV(Button, {\n      id: \"register\",\n      onClick: emptyErrorContext,\n      children: \"Rekister\\xF6idy\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 9\n    }, this) //Rekisteröitymispainikkeen näkyvyyden muuttaminen\n    ;\n\n    const emailHandler = e => {\n      e.preventDefault();\n      setUser({ ...user,\n        email: e.target.value\n      });\n    };\n\n    const passwordHandler = e => {\n      e.preventDefault();\n      setUser({ ...user,\n        password: e.target.value\n      });\n    };\n\n    const handleSubmit = e => {\n      if (login(user, errorContext.setAppError, userContext.login, userContext.setUsertype, userContext.setFirstname) === \"virhe\") {\n        setModalShow(true);\n      } else {\n        //JOS TÄMÄN OTTAA POIS, SISÄÄNKIRJAUTUMINEN EI VÄLÄHDÄ\n        closeErrorMessage();\n      }\n    };\n\n    const closeErrorMessage = () => {\n      //Kun painetaan rastia virheilmoituksessa, suljetaan virheilmoitus ja poistetaan virhe errorcontextista\n      setShow(false);\n      errorContext.setAppError(null);\n    };\n\n    if (userContext.Success === true) {\n      registerationSuccess = /*#__PURE__*/_jsxDEV(Alert, {\n        variant: \"success\",\n        children: \"Rekister\\xF6ityminen onnistui!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 11\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: UserContext.isLoggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 37\n      }, this) : /*#__PURE__*/_jsxDEV(Modal, { ...props,\n        \"aria-labelledby\": \"contained-modal-title-vcenter\",\n        centered: true,\n        backdrop: \"static\",\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            id: \"contained-modal-title-vcenter\",\n            children: \"Kirjaudu sis\\xE4\\xE4n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: [/*#__PURE__*/_jsxDEV(Form, {\n            children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n              children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n                children: \"Kirjoita s\\xE4hk\\xF6posti ja salasana\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"S\\xE4hk\\xF6posti:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 97,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"email\",\n                placeholder: \"Sy\\xF6t\\xE4 s\\xE4hk\\xF6posti\",\n                required: true,\n                value: user.email,\n                onChange: e => emailHandler(e)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 98,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Salasana:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 101,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"password\",\n                placeholder: \"Sy\\xF6t\\xE4 salasana\",\n                required: true,\n                value: user.password,\n                onChange: e => passwordHandler(e)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 102,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 105,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                id: \"logIn\",\n                onClick: () => {\n                  handleSubmit();\n                },\n                children: \"Kirjaudu sis\\xE4\\xE4n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 106,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 11\n            }, this), errorContext.appError && /*#__PURE__*/_jsxDEV(Alert, {\n              variant: \"danger\",\n              onClose: () => closeErrorMessage(),\n              dismissible: true,\n              children: [/*#__PURE__*/_jsxDEV(Alert.Heading, {\n                children: \"Virhe\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 110,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: errorContext.appError\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 11\n            }, this), registerationSuccess]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n            children: \"Eik\\xF6 sinulla ole viel\\xE4 tili\\xE4?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 11\n          }, this), button, visible && /*#__PURE__*/_jsxDEV(Register, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 23\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            onClick: closeModalWindow,\n            children: \"Sulje\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 11\n      }, this)\n    }, void 0, false);\n  }\n\n  _s(MyVerticallyCenteredModal, \"4V/07Rhxa8ZxXdDKtQUyCB+kVYk=\");\n\n  const closeModalWindow = () => {\n    //Kutsutaan, kun halutaan sulkea kirjautumiseen/rekisteröitymiseen tarkoitettu modaali-ikkuna\n    errorContext.setAppError(null); //Tyhjennetään mahdolliset kirjautumisessa tai rekisteröitymisessä tulleet virheet errorContextista\n\n    userContext.setSuccess(false); //Vaihdetaan Success-arvo falseksi, kun suljetaan modaali-ikkuna. Näin onnistuminen rekisteröitymisestä ei näy enää, jos ikkuna avataan uudestaan\n\n    setModalShow(false); //Suljetaan modaalinen ikkuna\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(MyVerticallyCenteredModal, {\n      show: modalShow,\n      onHide: closeModalWindow\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 11\n    }, this), loginButton]\n  }, void 0, true);\n};\n\n_s2(Login, \"0UwCoCh3AxEg4YCBe0jCqby026g=\", false, function () {\n  return [useHistory];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["C:/Users/jenni/Documents/GitHub/harjoitus4-JenniMERN/frontend/src/components/Login.js"],"names":["React","useContext","useState","Button","Form","Alert","Modal","UserContext","ErrorContext","login","logout","Register","BrowserRouter","Redirect","useHistory","Login","userContext","errorContext","modalShow","setModalShow","show","setShow","history","registerationSuccess","logOut","setEmail","setUsertype","setFirstname","console","log","push","loginButton","isLoggedIn","MyVerticallyCenteredModal","props","user","setUser","password","name","email","visible","setVisible","emptyErrorContext","e","setAppError","button","emailHandler","preventDefault","target","value","passwordHandler","handleSubmit","closeErrorMessage","Success","appError","closeModalWindow","setSuccess"],"mappings":"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","sourcesContent":["import React, {useContext, useState} from 'react';\r\nimport {Button, Form, Alert, Modal} from 'react-bootstrap';\r\nimport UserContext from '../contexts/UserContext';\r\nimport ErrorContext from '../contexts/ErrorContext';\r\nimport {login, logout} from '../user/services/user-services';\r\nimport Register from './Register';\r\nimport {BrowserRouter as Redirect, useHistory} from 'react-router-dom'; //Applikaation sivujen reititys\r\n\r\nconst Login = () => {\r\n  const userContext = useContext(UserContext);\r\n  const errorContext = useContext(ErrorContext);\r\n  const [modalShow, setModalShow] = useState(false);\r\n  const [show, setShow] = useState(true); //Virheilmoituksen näyttämiseen\r\n  let history = useHistory();\r\n  let registerationSuccess = \"\"; //Alustetaan muuttuja, jotta ilmoitus rekisteröitymisen onnistumisesta pystytään näyttämään\r\n  const logOut = () => {\r\n    logout(userContext.logout, userContext.setEmail, userContext.setUsertype, userContext.setFirstname) //Kirjaudutaan ulos userContextissa olevan metodin avulla\r\n    console.log(userContext);\r\n    history.push('/') //Palataan etusivulle\r\n  }\r\n  //Määritetään loginButtonin ulkoasu ja toiminnot sen perusteella, onko käyttäjä kirjautunut vai ei\r\n  let loginButton;\r\n  if(userContext.isLoggedIn===true){\r\n    loginButton = (<Button variant=\"danger\"  onClick={logOut}>Kirjaudu ulos</Button>);\r\n  } else {\r\n    loginButton = (<Button variant=\"primary\" onClick={() => setModalShow(true)}>Kirjaudu</Button>);\r\n  }\r\n  console.log(userContext);\r\n  \r\n    function MyVerticallyCenteredModal(props) {\r\n    \r\n      const [user, setUser] = useState({\r\n        password: \"\",\r\n        name: \"\",\r\n        email: \"\"\r\n      });\r\n      const [visible, setVisible] = useState(false); //Rekisteröitymis-painiketta varten\r\n\r\n      const emptyErrorContext = (e) => {\r\n        errorContext.setAppError(null);\r\n        setVisible(!visible);\r\n      }\r\n      \r\n      const button = (\r\n        <Button id=\"register\" onClick={emptyErrorContext}>Rekisteröidy</Button> //Rekisteröitymispainikkeen näkyvyyden muuttaminen\r\n      );\r\n\r\n      const emailHandler = (e) => {\r\n        e.preventDefault();\r\n        setUser({...user, email:e.target.value});\r\n      };\r\n\r\n      const passwordHandler = (e) => {\r\n        e.preventDefault();\r\n        setUser({...user, password:e.target.value});\r\n      };\r\n\r\n      const handleSubmit = (e) => {\r\n          if(login(user, errorContext.setAppError, userContext.login, userContext.setUsertype, userContext.setFirstname)===\"virhe\"){\r\n            setModalShow(true);\r\n          } else {//JOS TÄMÄN OTTAA POIS, SISÄÄNKIRJAUTUMINEN EI VÄLÄHDÄ\r\n            closeErrorMessage();\r\n          }\r\n      }\r\n\r\n      const closeErrorMessage = () => { //Kun painetaan rastia virheilmoituksessa, suljetaan virheilmoitus ja poistetaan virhe errorcontextista\r\n        setShow(false);\r\n        errorContext.setAppError(null);\r\n      };\r\n      \r\n      if(userContext.Success===true){\r\n        registerationSuccess = (\r\n          <Alert variant=\"success\">\r\n            Rekisteröityminen onnistui!\r\n        </Alert>\r\n        );\r\n      }\r\n        return(\r\n         <>\r\n          {UserContext.isLoggedIn ? <Redirect to='/'/>:\r\n          \r\n          <Modal\r\n        {...props}\r\n        aria-labelledby=\"contained-modal-title-vcenter\"\r\n        centered\r\n        backdrop=\"static\"\r\n      >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title id=\"contained-modal-title-vcenter\">\r\n            Kirjaudu sisään\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n        <Form>\r\n          <Form.Group>\r\n            <h6>Kirjoita sähköposti ja salasana</h6>\r\n            <Form.Label>Sähköposti:</Form.Label>\r\n            <Form.Control type=\"email\" placeholder=\"Syötä sähköposti\" \r\n            required value={user.email}\r\n            onChange={(e) => emailHandler(e)}/>\r\n            <Form.Label>Salasana:</Form.Label>\r\n            <Form.Control type=\"password\" placeholder=\"Syötä salasana\"\r\n            required value={user.password}\r\n            onChange={(e) => passwordHandler(e)} />\r\n            <br />\r\n            <Button id=\"logIn\" onClick={() =>{handleSubmit();}}>Kirjaudu sisään</Button>\r\n          </Form.Group>\r\n          {errorContext.appError && \r\n          <Alert variant=\"danger\" onClose={() => closeErrorMessage()} dismissible>\r\n            <Alert.Heading>Virhe</Alert.Heading>\r\n            <p>\r\n              {errorContext.appError}\r\n            </p>\r\n          </Alert>\r\n          }\r\n          {registerationSuccess}\r\n        </Form>\r\n          <br />\r\n          <h6>Eikö sinulla ole vielä tiliä?</h6>\r\n          {button}\r\n          {visible && <Register />}\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button onClick={closeModalWindow}>Sulje</Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    }\r\n      </>\r\n        );\r\n        \r\n    }\r\n    const closeModalWindow = () => { //Kutsutaan, kun halutaan sulkea kirjautumiseen/rekisteröitymiseen tarkoitettu modaali-ikkuna\r\n      errorContext.setAppError(null); //Tyhjennetään mahdolliset kirjautumisessa tai rekisteröitymisessä tulleet virheet errorContextista\r\n      userContext.setSuccess(false); //Vaihdetaan Success-arvo falseksi, kun suljetaan modaali-ikkuna. Näin onnistuminen rekisteröitymisestä ei näy enää, jos ikkuna avataan uudestaan\r\n      setModalShow(false); //Suljetaan modaalinen ikkuna\r\n    };\r\n\r\n    return(\r\n        <>\r\n          <MyVerticallyCenteredModal\r\n            show={modalShow}\r\n            onHide={closeModalWindow}\r\n          />\r\n          {loginButton}\r\n        </>\r\n    )\r\n}\r\nexport default Login;"]},"metadata":{},"sourceType":"module"}